# Encryption Runbook

## Scope

- 일반 로그인 계정: 로컬/원격 상태 암호화 적용
- 익명 계정: 암호화 미적용(기존 동작 유지)

## Policy

1. 암호화 키는 로그인 비밀번호를 기반으로 생성한다.
2. 서버는 평문 앱 상태를 보관하지 않는다(일반 계정 기준).
3. 암호화 키는 메모리에만 유지하며 로그아웃 시 폐기한다.
4. 비밀번호를 모르면 복호화가 불가능하다.

## Technical Notes

- Algorithm: `AES-GCM-256`
- KDF: `PBKDF2-SHA-256`
- Envelope fields:
  - `__enc_v`
  - `alg`
  - `kdf`
  - `iter`
  - `salt`
  - `iv`
  - `ct`

## User Flows

1. 일반 로그인 성공
2. 암호 해제 모달에 로그인 비밀번호 입력
3. 로컬/원격 암호화 상태 복호화 후 앱 로드

## Incident Response

### 1) 복호화 실패

1. 비밀번호 재입력 유도
2. 동일 증상 지속 시 최근 비밀번호 변경 여부 확인
3. 로그아웃 후 재로그인 재시도

### 2) 동기화 실패

1. 네트워크 상태 확인
2. 자동 재시도(최대 3회) 대기
3. 수동 동기화 버튼 실행

### 3) 비밀번호 변경 직후 문제

1. 변경 전 비밀번호로는 복호화 불가 가능성 안내
2. 로그인 세션 재생성 후 최신 상태 확인

## QA Checklist

1. 일반 계정 로그인 후 저장 시 `localStorage` 값이 암호문인지 확인
2. 원격 `editor_states.state_json`가 암호문 구조인지 확인
3. 익명 로그인은 평문 경로가 유지되는지 확인
4. 잘못된 비밀번호 입력 시 복호화 실패 메시지 확인
5. 자동 재시도 메시지/횟수 제한 동작 확인
