# PART 01. 인증/동기화/보안

작성일: 2026-02-16

## 1) 목표

- 로그인 경로를 단순화하고(아이디 우선), 데이터 유실/충돌/복호화 실패 리스크를 낮추는 것.

## 2) 주요 변경

### 인증
- 아이디+비밀번호 UX 도입, 내부적으로 synthetic email 매핑 사용
- 익명 로그인 유지 및 익명 -> 일반 계정 전환 경로 유지
- 관련 커밋: `de5aa22`, `8a33daf`

### 암호화
- 일반 계정 데이터 암호화(AES-GCM + PBKDF2) 적용
- 로그인 직후 잠금 해제 흐름/오류 처리 강화
- 관련 커밋: `474bb77`, `be65f9f`

### 동기화
- 자동 동기화 실패 시 지수 백오프 재시도
- 충돌 감지 및 분기 처리 강화
- 로그아웃 직전 동기화 시도/예외 처리
- 관련 커밋: `8172f5c`, `be65f9f`

### SDK fallback/로컬 포함
- CDN 차단 시 fallback 경로 유지
- 로컬 SDK(`vendor/supabase.js`)를 로딩 우선순위에 포함
- 직접 선로드 충돌 이슈 수정(동적 로드로 복구)
- 관련 커밋: `c0e1970`, `d1f77f9`

## 3) 영향 파일

- `app.js` (인증/세션/동기화/SDK 로더)
- `crypto-utils.js` (암복호화 유틸)
- `docs/ENCRYPTION_RUNBOOK.md`
- `docs/SYNC_REGRESSION_CHECKLIST.md`

## 4) 회귀/장애 이력

- 증상: SDK 선로드 후 로그인 화면 버튼 비동작
- 원인: 전역 로딩 방식 충돌로 앱 초기화 실패
- 조치: `index.html`에서 선로드 제거, `app.js` 동적 로더만 사용
- 결과: 로그인 이벤트 바인딩 복구

## 5) 현재 운영 기준

- SDK 로딩 순서: `vendor/supabase.js` -> `jsdelivr` -> `unpkg`
- 일반 계정: 암호화 경로
- 익명 계정: 평문 경로

